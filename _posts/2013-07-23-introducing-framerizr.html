---
layout: post
title: Introducing Framerizr
date: 2013-07-23 01:50:58.000000000 -05:00
type: post
published: true
status: publish
categories:
- Tweaks
tags:
- ASP.NET
- auto height
- Cross Domain
- easyXDM
- iframe
- realtime
meta:
  _edit_last: '26965888'
  geo_public: '0'
  _publicize_pending: '1'
  _wpas_done_3086375: '1'
  tagazine-media: a:7:{s:7:"primary";s:0:"";s:6:"images";a:0:{}s:6:"videos";a:0:{}s:11:"image_count";i:0;s:6:"author";s:8:"26965888";s:7:"blog_id";s:8:"31371023";s:9:"mod_stamp";s:19:"2013-07-23
    06:50:58";}
  publicize_twitter_user: nebtrx
  _wpas_done_3086381: '1'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:501807906;b:1;}}
author:
  login: neb85
  email: neb.trx@gmail.com
  display_name: Neb
  first_name: ''
  last_name: ''
---
<p>About a month ago I was trying to embed an ASP.NET MVC 3 App inside an external web using iframes, that sometimes useful nature’s aborted baby. It was all happy until I found me wishing Darth Vader kill me using telekinesis because the iframe was showing up .. guess what? .. a vertical scroll. That fact unleashed a sequence of events which I will summarize as short as possible ( because I almost hate writing codeless text ): <em>I had to find a solution which allow me to dynamically adjust the height of the host iframe, in a way I can iframe(or how I like to call it: framerize) any web of my site without worrying about html body content height (especially when it changes during AJAX Requests ).</em></p>
<p>So, the solution had to satisfy the following requisites:</p>
<ol>
<li>It had to be in Javascript(reasonable).</li>
<li>It had to works in realtime.</li>
<li>It had to be X Domain.</li>
<li>It had to detect DOM chages which affect HTML Body Height.</li>
<li>It had to require minimal changes to existent views.</li>
</ol>
<p>After a little of research I found the best way to achieve that was monitoring the size of the enclosed html content using <a href="https://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html#mutationobserver">DOM Mutation Observers</a> for detecting height changes in the html body and <a href="http://easyxdm.net/wp/2010/03/17/setting-up-your-first-socket/">easyXDM Sockets</a> which allow me to perform X Domain Javascript calls for pushing this info to the iframe in the external web.</p>
<p>Server side script fragment:</p>
<pre>pushData: function () {
framerizr.server.socket.postMessage($("iframe").contents().find('body').height() + 20);
},

..

MutationObserver = window.MutationObserver || window.WebKitMutationObserver;

var observer = new MutationObserver(function (mutations, observer) {
// fired when a mutation occurs

// there is a time between detecting the change and change render process difficult to catch,
// so wait until DOM renders up!.
setTimeout(function () {
framerizr.server.pushData();
}, 500);
});

// define what element should be observed by the observer
// and what types of mutations trigger the callback
observer.observe(document.getElementsByTagName("iframe")[0].contentDocument.getElementsByTagName("body")[0], {
subtree: true,
attributes: true
});</pre>
<p>Client side script fragment:</p>
<pre>new easyXDM.Socket({
// remote uri for html content served
remote: remote,
// iframe container
container: $container[0],
onMessage: function(message, origin) {
// resizing
$container.find('iframe').height(message + "px");
$container.height(message + "px");
}
});</pre>
<p>With this, requisites 1 to 4 were checked.</p>
<p>But there was a problem: <em>easyXDM Sockets</em> get closed when you browse away from the iframe src. It was a low punch, but after a neurons ball dance I decided to ad an additional controller <em>FramerizrController</em>  in my ASP.NET MVC Web Application to serves any requested URI of my own application inside a 100% dimension wide iframe which I called <em>transitional iframe</em>.This way the transitional iframe is used to serve the html content while keeping opened the easyXDM socket, otherwise once you browse away the connection will be closed and height monitoring stops working. An advantage of this approach was requisite 5 was achieved as a collateral bonus.</p>
<p>For better understanding(yes because wordpress code tags sucks, they should really think about using markdown syntax) and downloading the full sources refer to <a href="https://bitbucket.org/nebtrx/framerizr">bitbucket project</a>. Or if you feel too lazy today and you just want a solution ready to use, you may install the Nuget Package Framerizr.MVC(authored by me), which does all that for you, just typing the following in your Package Manager Console:</p>
<pre>PM&gt; Install-Package Framerizr.MVC</pre>
<p>That's all for today folks.<br />
See ya in the next one.</p>
